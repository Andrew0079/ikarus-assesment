[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:mssql]
command=/opt/mssql/bin/sqlservr
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/mssql.err.log
stdout_logfile=/var/log/supervisor/mssql.out.log
priority=1

[program:redis]
command=redis-server
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/redis.err.log
stdout_logfile=/var/log/supervisor/redis.out.log
priority=2

[program:backend]
command=sh -c "sleep 15 && python3 scripts/ensure_mssql_db.py && alembic upgrade head && exec gunicorn --config gunicorn.conf.py 'app:create_app()'"
directory=/app/backend
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/backend.err.log
stdout_logfile=/var/log/supervisor/backend.out.log
environment=DATABASE_URL="mssql+pymssql://sa:[REDACTED]@localhost:1433/weatherapp",JWT_SECRET_KEY="[REDACTED]",RATELIMIT_STORAGE_URL="redis://localhost:6379",PORT="5000"
priority=3

[program:frontend]
command=npx serve -s dist -l 8080
directory=/app/frontend
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/frontend.err.log
stdout_logfile=/var/log/supervisor/frontend.out.log
priority=4

