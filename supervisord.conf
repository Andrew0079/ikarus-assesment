[supervisord]
nodaemon=true

[program:mssql]
command=/opt/mssql/bin/sqlservr
priority=1
autostart=true
autorestart=true

[program:redis]
command=redis-server
priority=2
autostart=true
autorestart=true

[program:backend]
command=sh -c "sleep 25 && python3 scripts/ensure_mssql_db.py && alembic upgrade head && exec gunicorn --config gunicorn.conf.py 'app:create_app()'"
directory=/app/backend
environment=DATABASE_URL="%(ENV_DATABASE_URL)s",JWT_SECRET_KEY="%(ENV_JWT_SECRET_KEY)s",RATELIMIT_STORAGE_URL="redis://localhost:6379",PORT="%(ENV_PORT)s"
priority=3
autostart=true
autorestart=true

[program:frontend]
command=serve -s dist -l 8080
directory=/app/frontend
priority=4
autostart=true
autorestart=true

